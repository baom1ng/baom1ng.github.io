{"title":"Kubernetes1.27-containerd1.7集群安装","uid":"151d99aa718e6ed80f8a5120c08988a5","slug":"Kubernetes1-27-containerd1-7集群安装","date":"2023-02-19T02:39:13.000Z","updated":"2023-06-19T11:53:22.414Z","comments":true,"path":"api/articles/Kubernetes1-27-containerd1-7集群安装.json","keywords":"Brevin, blog, 技术, 博客","cover":"/images/Kubernetes1.27-containerd1.7集群安装/k8s-logo.png","content":"<h1 id=\"Kubernetes1-27-containerd1-7集群安装\"><a href=\"#Kubernetes1-27-containerd1-7集群安装\" class=\"headerlink\" title=\"Kubernetes1.27-containerd1.7集群安装\"></a>Kubernetes1.27-containerd1.7集群安装</h1><img src=\"/images/Kubernetes1.27-containerd1.7集群安装/k8s-logo.png\" alt=\"Collection of Kubernets Logo PNG. | PlusPNG\" style=\"zoom: 25%;\" />\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">主机名称</th>\n<th>操作系统</th>\n<th>IP地址</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Master</td>\n<td>Ubuntu 22.04.2 LTS</td>\n<td>192.168.10.15</td>\n<td>控制节点</td>\n</tr>\n<tr>\n<td align=\"left\">Work1</td>\n<td>Ubuntu 22.04.2 LTS</td>\n<td>192.168.10.16</td>\n<td>工作节点1</td>\n</tr>\n<tr>\n<td align=\"left\">Work2</td>\n<td>Ubuntu 22.04.2 LTS</td>\n<td>192.168.10.17</td>\n<td>工作节点2</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-安装containerd-所有节点\"><a href=\"#1-安装containerd-所有节点\" class=\"headerlink\" title=\"1.安装containerd(所有节点)\"></a>1.安装containerd(所有节点)</h3><p><strong>根据系统和CPU类型选择cri-containerd-cni文件进行下载。下载完成后，将文件copy至主机。也可以直接使用wget命令下载。</strong></p>\n<p><img src=\"/images/Kubernetes1.27-containerd1.7%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/github-container.png\" alt=\"image-20230612150556837\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 1: 从github上获取containerd</span></span><br><span class=\"line\">sudo wget https://github.com/containerd/containerd/releases/download/v1.7.2/cri-containerd-1.7.2-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 2: 解压</span></span><br><span class=\"line\">tar xzf cri-containerd-cni-1.7.2-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 3: 复制配置文件</span></span><br><span class=\"line\">sudo cp etc/crictl.yaml /etc/</span><br><span class=\"line\">sudo cp etc/systemd/system/containerd.service /etc/systemd/system/</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 4: 安装containerd 和相关依赖</span></span><br><span class=\"line\">sudo cp usr/local/bin/* /usr/local/bin/</span><br><span class=\"line\">sudo cp usr/local/sbin/* /usr/local/sbin/</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 5: 生成和配置启动文件</span></span><br><span class=\"line\">sudo mkdir -p /etc/containerd</span><br><span class=\"line\">sudo containerd config default &gt; /etc/containerd/config.toml</span><br><span class=\"line\">sudo sed -i &#x27;s#registry.k8s.io/pause:3.6#registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9#g&#x27; /etc/containerd/config.toml</span><br><span class=\"line\">sudo sed -i &#x27;s#SystemdCgroup = false#SystemdCgroup = true#g&#x27;  /etc/containerd/config.toml</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 6: 重启containerd并设置开机启动</span></span><br><span class=\"line\">sudo systemctl restart containerd</span><br><span class=\"line\">sudo systemctl enable containerd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-主机初始化配置-所有节点\"><a href=\"#2-主机初始化配置-所有节点\" class=\"headerlink\" title=\"2.主机初始化配置(所有节点)\"></a>2.主机初始化配置(所有节点)</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">集群主机名</span></span><br><span class=\"line\">sudo su</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用sudo执行会失败，切换root</span></span><br><span class=\"line\">echo &quot;192.168.10.15  master&quot; &gt;&gt; /etc/hosts</span><br><span class=\"line\">echo &quot;192.168.10.16  work1&quot; &gt;&gt; /etc/hosts</span><br><span class=\"line\">echo &quot;192.168.10.17  work2&quot; &gt;&gt; /etc/hosts</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">交换分区</span></span><br><span class=\"line\">sudo sed -i &#x27;s/^\\(.*swap.*\\)$/#\\1/g&#x27; /etc/fstab</span><br><span class=\"line\">sudo swapoff -a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">网络内核模块</span></span><br><span class=\"line\">sudo tee /etc/modules-load.d/containerd.conf &lt;&lt;EOF</span><br><span class=\"line\">overlay</span><br><span class=\"line\">br_netfilter</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">sudo modprobe overlay</span><br><span class=\"line\">sudo modprobe br_netfilter</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">数据包转发</span></span><br><span class=\"line\">sudo tee /etc/sysctl.d/kubernetes.conf &lt;&lt;EOF</span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = 1</span><br><span class=\"line\">net.ipv4.ip_forward = 1</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">sudo sysctl --system</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置 Kubernetes 集群相关的防火墙规则</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在主节点执行：</span></span><br><span class=\"line\">sudo ufw allow 6443/tcp</span><br><span class=\"line\">sudo ufw allow 2379/tcp</span><br><span class=\"line\">sudo ufw allow 2380/tcp</span><br><span class=\"line\">sudo ufw allow 10250/tcp</span><br><span class=\"line\">sudo ufw allow 10251/tcp</span><br><span class=\"line\">sudo ufw allow 10252/tcp</span><br><span class=\"line\">sudo ufw allow 10255/tcp</span><br><span class=\"line\">sudo ufw reload</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在工作节点执行：</span></span><br><span class=\"line\">sudo ufw allow 10250/tcp</span><br><span class=\"line\">sudo ufw allow 30000:32767/tcp</span><br><span class=\"line\">sudo ufw reload</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">k8s源</span></span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install -y apt-transport-https</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用sudo执行会失败，切换root</span></span><br><span class=\"line\">sudo su</span><br><span class=\"line\">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class=\"line\">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class=\"line\">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装k8s</span></span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install -y kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-修改crictl配置文件-所有节点\"><a href=\"#3-修改crictl配置文件-所有节点\" class=\"headerlink\" title=\"3.修改crictl配置文件(所有节点)\"></a>3.修改crictl配置文件(所有节点)</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改crictl配置文件，获得containerd的sock信息，没有该文件的话创建一个</span></span><br><span class=\"line\">cat /etc/crictl.yaml </span><br><span class=\"line\">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class=\"line\">image-endpoint: unix:///run/containerd/containerd.sock</span><br><span class=\"line\">timeout: 10</span><br><span class=\"line\">debug: false</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-初始化-控制节点\"><a href=\"#4-初始化-控制节点\" class=\"headerlink\" title=\"4.初始化(控制节点)\"></a>4.初始化(控制节点)</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo kubeadm init --kubernetes-version=1.27.2 --apiserver-advertise-address=192.168.10.15 --apiserver-bind-port=6443 --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16 --cri-socket=unix:///run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">apiserver-advertise-address需要使用本机上网卡的ip，否则的话会导致etcd绑定ip失败启动不了，从而apiserver也启动不了</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>初始化成功，显示如下信息</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Your Kubernetes control-plane has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p $HOME/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, if you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join 192.168.10.15:6443 --token vo2r54.7jdugv0ivp91po0w \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:2b6ec05aa042aab6f2f51d6b9052fa062e265dc68707d416a7e341c05e79bd58</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>执行上面的提示的命令</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p $HOME/.kube</span><br><span class=\"line\">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>\n\n<p><strong>执行kubectl get node我们可以看到节点处于NotReady状态，需要安装flannel</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get node</span><br><span class=\"line\">NAME     STATUS     ROLES           AGE   VERSION</span><br><span class=\"line\">master   NotReady   control-plane   42m   v1.27.2</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用kubectl安装flannel</span></span><br><span class=\"line\">kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br></pre></td></tr></table></figure>\n\n<p><strong>如果网络无法访问github可以手动创建kube-flannel.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Namespace</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">pod-security.kubernetes.io/enforce:</span> <span class=\"string\">privileged</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/status</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">patch</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">networking.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">clustercidrs</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">cni-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;plugins&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;delegate&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;hairpinMode&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;isDefaultGateway&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;capabilities&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;portMappings&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"attr\">net-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Backend&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-ds</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">      <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">        <span class=\"attr\">k8s-app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">        <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">kubernetes.io/os</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--ip-masq</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kube-subnet-mgr</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/bin/flanneld</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAMESPACE</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.namespace</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">EVENT_QUEUE_DEPTH</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;5000&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">docker.io/flannel/flannel:v0.22.0</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">50Mi</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">capabilities:</span></span><br><span class=\"line\">            <span class=\"attr\">add:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">NET_ADMIN</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">NET_RAW</span></span><br><span class=\"line\">          <span class=\"attr\">privileged:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/run/xtables.lock</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">xtables-lock</span></span><br><span class=\"line\">      <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">initContainers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/flannel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/cni/bin/flannel</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">docker.io/flannel/flannel-cni-plugin:v1.1.2</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">install-cni-plugin</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/kube-flannel/cni-conf.json</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">docker.io/flannel/flannel:v0.22.0</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">install-cni</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-node-critical</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\">        <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">configMap:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/run/xtables.lock</span></span><br><span class=\"line\">          <span class=\"attr\">type:</span> <span class=\"string\">FileOrCreate</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">xtables-lock</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>执行完后，查看flannel是否启动成功</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods -n kube-flannel</span><br><span class=\"line\">NAME                    READY   STATUS    RESTARTS      AGE</span><br><span class=\"line\">kube-flannel-ds-7vqgt   1/1     Running   0             32m</span><br><span class=\"line\">kube-flannel-ds-b9n72   1/1     Running   3 (84s ago)   8m20s</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看节点状态,显示ready</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get node</span><br><span class=\"line\">NAME     STATUS   ROLES           AGE   VERSION</span><br><span class=\"line\">master   Ready    control-plane   86m   v1.27.2</span><br><span class=\"line\">work1    Ready    &lt;none&gt;          15m   v1.27.2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-将work节点加入集群-所有work节点\"><a href=\"#5-将work节点加入集群-所有work节点\" class=\"headerlink\" title=\"5.将work节点加入集群(所有work节点)\"></a>5.将work节点加入集群(所有work节点)</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo kubeadm join 192.168.10.15:6443 --token 6zw8z1.7j90zp477rv2kct6 --discovery-token-ca-cert-hash sha256:2b6ec05aa042aab6f2f51d6b9052fa062e265dc68707d416a7e341c05e79bd58</span><br></pre></td></tr></table></figure>\n\n<p><strong>执行完成后我们再主节点产看nodes</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get  nodes</span><br><span class=\"line\">NAME     STATUS   ROLES           AGE     VERSION</span><br><span class=\"line\">master   Ready    control-plane   96m     v1.27.2</span><br><span class=\"line\">work1    Ready    &lt;none&gt;          25m     v1.27.2</span><br><span class=\"line\">work2    Ready    &lt;none&gt;          7m25s   v1.27.2</span><br></pre></td></tr></table></figure>\n\n<p><strong>这里显示所有节点Ready表示k8s集群安装成功</strong></p>\n","feature":true,"text":"Kubernetes1.27-containerd1.7集群安装 主机名称 操作系统 IP地址 说明 Master Ubuntu 22.04.2 LTS 192.168.10.15 控制节点 Work1 Ubuntu 22.04.2 LTS 192.168.10.16 工作节点1...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"Kubernetes","slug":"Kubernetes","count":1,"path":"api/categories/Kubernetes.json"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","count":1,"path":"api/tags/Kubernetes.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Kubernetes1-27-containerd1-7%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">Kubernetes1.27-containerd1.7集群安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E5%AE%89%E8%A3%85containerd-%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">1.安装containerd(所有节点)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E4%B8%BB%E6%9C%BA%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE-%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">2.主机初始化配置(所有节点)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E4%BF%AE%E6%94%B9crictl%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">3.修改crictl配置文件(所有节点)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%88%9D%E5%A7%8B%E5%8C%96-%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">4.初始化(控制节点)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E5%B0%86work%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4-%E6%89%80%E6%9C%89work%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">5.将work节点加入集群(所有work节点)</span></a></li></ol></li></ol></li></ol>","author":{"name":"Brevin","slug":"blog-author","avatar":"/images/avatar.jpeg","link":"/","description":"Welcome to my blog <br/> I'm Brevin Bao.-a DevOps.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Docker-Compose","uid":"0361f9a39ac53c480f13924da3215802","slug":"Docker-Compose","date":"2022-10-16T02:38:51.000Z","updated":"2022-10-26T04:21:20.610Z","comments":true,"path":"api/articles/Docker-Compose.json","keywords":"Brevin, blog, 技术, 博客","cover":"/images/docker-compose.jpg","text":"简介Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 OpenStack 中的 Heat 十分类似。 其代码目前在 https://github.com/docker/compose 上开源。 Compose 定位...","link":"","photos":[],"count_time":{"symbolsCount":"7.7k","symbolsTime":"7 mins."},"categories":[{"name":"Docker","slug":"Docker","count":6,"path":"api/categories/Docker.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"}],"author":{"name":"Brevin","slug":"blog-author","avatar":"/images/avatar.jpeg","link":"/","description":"Welcome to my blog <br/> I'm Brevin Bao.-a DevOps.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}